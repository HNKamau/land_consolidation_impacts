
---
title: <span style="font-size:24px;">Simulating outcomes of the effects of land consolidation to support farmer's decision for improved livelihood</span>
author: |
  <span style="font-size:16px;">Hannah Kamau<sup>1,@</sup></span>;
  <span style="font-size:16px;">Cory Whitney<sup>1,2</sup></span>
date: "2024-10-09"
output: 
  html_document:
    toc: true
    toc_depth: 2
bibliography: bib/references.bib
---

<span style="font-size:14px;"><sup>1</sup> Center for Development Research (ZEF), University of Bonn, Genscherallee 3, 53113 Bonn, Germany</span>
<br>
<span style="font-size:14px;"><sup>2</sup> INRES-Horticultural Sciences, University of Bonn, Auf dem Hugel 6, 53121 Bonn, Germany</span>
<br>
<span style="font-size:14px;"><sup>@</sup> Corresponding author's email: hannah.nyakio@gmail.com</span>



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### Introduction

This document is part of the supplementary resources and contains describes the model used to simulate outcomes of the effects of land consolidation for farmers in Kenya. This model is a result of the transcription of a conceptual model that was co-created and developed with the stakeholders during data collected in March 2024. We coded and programmed the model in using `decisonSupport` package [@luedeling_decisionsupport_2022] in @r_r_2022. This document was generated using `Rmarkdown` and `knitr` libraries [@Xie_Rmarkdown_2020;@Xie_knitr_2022].

Data input table: `FarmerLC_inputdata.csv`



```{r first things first}
#install.packages("decisionSupport")
library(decisionSupport)

set.seed(254)
```

```{r make variables}
make_variables <- function(est, n=1){
  x <- random(rho = est, n = n) 
  for(i in colnames(x))assign(i, as.numeric(x[1,i]), envir = .GlobalEnv)
}
make_variables(decisionSupport::estimate_read_csv("Input_tables/FarmerLC_inputdata.csv",
                                                  sep = ";"))

```

#### Function

```{r function}
farmer <- function(x, varnames)
  {

# A) farmer benefits without intervention ####
# We use maize equivalent of farm yield and the value of natural capital (trees) 
# to calculate pre intervention benefits that a farmer has and will have during 
# the project period. 

# ex-ante risks to farmers crops
natural_hazard
pest_disease_risk
farmer_inadequate_funds_risk
late_planting_risk
health_risk

prop_maize_yield_lost_hazard <- chance_event(natural_hazard, 
                  yield_loss_drought/100, 0, gen_CV, n=n_years, one_draw = FALSE)
prop_maize_yield_lost_disease <- chance_event(pest_disease_risk,
                  yield_loss_disease/100, 0, gen_CV,n=n_years, one_draw = FALSE)
prop_maize_yield_lost_input_constraint <- 
  chance_event(farmer_inadequate_funds_risk, yield_loss_due_to_input_constraint,
              0, gen_CV, n=n_years, one_draw = FALSE)
prop_maize_yield_lost_management <- 
       chance_event(min(late_planting_risk, health_risk),
       yield_loss_due_to_management, 0, gen_CV, n=n_years, one_draw = FALSE)

#effects of all the above risks                                                                                                      
farm_risks <- sapply(c(prop_maize_yield_lost_hazard + 
         prop_maize_yield_lost_disease + prop_maize_yield_lost_input_constraint
         + prop_maize_yield_lost_management),function(x) min(x,1))

farmer_yield_t_ha <- vv(maize_yield_t_ha, gen_CV, n_years) * no_of_seasons

adjusted_farmer_yield_t_ha <- farmer_yield_t_ha * (1 - farm_risks)


crop_benefit <- 
  adjusted_farmer_yield_t_ha *  ha_per_hh * 1000 * # conversion to kg/ha
  vv(maize_price_kes_kg, gen_CV, n_years) 

# natural capital  
adjusted_value_of_assets <-vv(value_of_farm_assets, gen_CV, n_years,
                              relative_trend = inflation_rate)

# Food cost saved from food accessible from the farm 
annual_saved_food_cost <- vv(saved_food_cost_pm, gen_CV, n_years, 
                             relative_trend = inflation_rate) * 12 

farmer_pre_interv_benefit <- crop_benefit + adjusted_value_of_assets +
                          annual_saved_food_cost

# B) Cost of the farmer before the intervention ####
# medical Bills from farm related stresses
 medical_bills <- prop_hhincome_spent_on_hospital/100 * 
                      vv(hh_income_pa, gen_CV,n_years)
 
# production costs for the farm
 farming_costs <- vv(production_costs_saved_acre, gen_CV, n_years, 
                     relative_trend = inflation_rate)*
                   ha_per_hh * ha_acre_conversion * no_of_seasons
 
 # planning cost involves legal fee and the cost of knowledge acquisition
 farmer_plan_cost  <- planning_cost
 
 farmer_pre_interv_cost <- medical_bills + farming_costs + farmer_plan_cost
                                                           
# C) Farmer  costs  with Intervention ####
 farmer_one_time_cost <- cost_of_disruption_kes + # Damages on physical assets
                         hhupkeep_prior_to_first_payment 
  # HH income needed to sustain the hh prior 1st payment
  
 # planning cost involves legal fee and the cost of knowledge acquisition
farmer_plan_cost  <- planning_cost
  
farmer_recurring_cost <- adjusted_value_of_assets + # loss
                    annual_saved_food_cost # Food unavailable from farm directly
  
farmer_cost_interv <-  farmer_one_time_cost +  farmer_plan_cost +
                  farmer_recurring_cost

# D) Farmer Benefits with Intervention ####
# farmer's annual compensation aka lessor fee
lessor_fee <-vv(compensation_income_pm_acre, gen_CV, n_years)* 2 * 
             ha_per_hh * ha_acre_conversion

#off farm employments and wages
off_farm_income <-vv(off_farm_income_kes_pm, gen_CV, n_years) *12

#income saved: production costs for farming
production_costs_saved <- farming_costs
# hospital bills saved (proxy for long term health) from farm related stresses
medical_bills_saved <- medical_bills  

# social cohesion benefit
# social cohesion is expressed as a factor of free time as a result of the 
# the intervention. With the intervention, free time is associated with 
# social cohesion through community participation and involvement. 
# We quantify it by the cost of labour per hour

# First, risks that threaten social cohesion are vices e.g crime, drug use,
# theft and domestic conflict - They take up time that would otherwise be used 
# for community cooperation or activities
  
social_time_risk <- max(vice_risk,
                        domesticconflict_risk)

adjusted_social_time <- vv(social_time_hr_day, gen_CV, n_years) *
                      (1-social_time_risk)
social_cohesion <- adjusted_social_time * vv(labour_cost_kes_hr, gen_CV, 
                                       n_years, relative_trend = inflation_rate)
      
# Better childhood benefit = long term benefit is education
# quantified by child's contribution to family farm labour weekly
# and the value of hired labour
      
better_childhood <- child_farm_time_hr_week * children_per_hh * 
                        n_weeks_child_farm_time *
                        vv(labour_cost_kes_hr, gen_CV, n_years, 
                           relative_trend = inflation_rate ) 

farmer_benefit_interv <-
  lessor_fee + off_farm_income + production_costs_saved + 
  sale_of_hh_items_not_needed +  medical_bills_saved + social_cohesion + 
  better_childhood

# E) Calculate net benefit ####
farmer_pre_interv_netbenefit_kes <- farmer_pre_interv_benefit -
                                            farmer_pre_interv_cost

result_pre_intervention <- farmer_pre_interv_netbenefit_kes/currency_change
    
farmer_interv_netbenefit_kes <- farmer_benefit_interv - farmer_cost_interv

result_intervention <- farmer_interv_netbenefit_kes/currency_change

# Calculate categorized costs and benefits ####
# Categories include 1) Food costs not saved 
food_cost_saved_npv <- discount(annual_saved_food_cost, discount_rate,
                                calculate_NPV = TRUE)
# 2) Natural assets lost 
natural_assets_npv <- discount(adjusted_value_of_assets, discount_rate,
                               calculate_NPV = T)
# 3) Planning cost 
# planning_npv <- farmer_plan_cost
# 4) Household income prior 1st payout  + 5) Disruption cost
# one_time_npv <- farmer_one_time_cost
# 6) Compensation for land
lease_npv <- discount(lessor_fee, discount_rate, calculate_NPV = T)
# 7) Production costs saved
prdn_costs_npv <- discount(farming_costs, discount_rate, calculate_NPV = T)
# 8) Alternative employment
alt_income_npv <- discount(off_farm_income, discount_rate, calculate_NPV = T)
# 9) Better childhood
better_childhood_npv <- discount(better_childhood, discount_rate,
                                 calculate_NPV = T)
# 10) Social cohesion
social_npv <- discount(social_cohesion, discount_rate, calculate_NPV = T)
# 11) Medical bills saved
medical_npv <- discount(medical_bills_saved, discount_rate, calculate_NPV = T)
# 12) Annual crop yield
crop_npv <- discount(crop_benefit, discount_rate, calculate_NPV = T)


# NPV ####
NPV_interv_kes <- discount(farmer_interv_netbenefit_kes, discount_rate,
                           calculate_NPV = TRUE)
NPV_intervention <- 
  discount(result_intervention, discount_rate, calculate_NPV = T)

NPV_n_interv_kes <- discount(farmer_pre_interv_netbenefit_kes, discount_rate,
                             calculate_NPV = TRUE)

NPV_n_intervention <- 
    discount(result_pre_intervention, discount_rate, calculate_NPV = T)

# Benefit cost ratio ####
# without intervention
npv_farmer_pre_interv_benefit <- discount(farmer_pre_interv_benefit, discount_rate,
                                          calculate_NPV = T)

npv_farmer_pre_interv_cost <- discount(farmer_pre_interv_cost, discount_rate,
                                       calculate_NPV = T)
bcr_n_interv <-npv_farmer_pre_interv_benefit/npv_farmer_pre_interv_cost
# with intervention
npv_farmer_benefit_interv <- discount(farmer_benefit_interv, discount_rate, 
                                      calculate_NPV = T)
npv_farmer_cost_interv <- discount(farmer_cost_interv, discount_rate, 
                                   calculate_NPV = T)
bcr_interv <- npv_farmer_benefit_interv/npv_farmer_cost_interv

   return(list(Interv_NPV = NPV_intervention,
               Interv_NPV_kes = NPV_interv_kes,
               No_Interv_NPV = NPV_n_intervention,
               No_Interv_NPV_kes = NPV_n_interv_kes,
               NPV_decision_kes = NPV_interv_kes - NPV_n_interv_kes,
               NPV_decision_do = NPV_intervention - NPV_n_intervention,
               BCR_no_interv = bcr_n_interv,
               BCR_interv = bcr_interv,
               Food_money_saved = food_cost_saved_npv,
               Natural_assets = natural_assets_npv,
               Planning = farmer_plan_cost, 
               Disruption_cost = farmer_one_time_cost,
               Lease = lease_npv, 
               Production_costs = prdn_costs_npv, 
               Alternative_income = alt_income_npv, 
               Childhood = better_childhood_npv,
               Social = social_npv,
               Medical = medical_npv,
               Annual_yield = crop_npv,
               Cashflow_decision_do = farmer_interv_netbenefit_kes -
                                    farmer_pre_interv_netbenefit_kes))
}

```


```{r simulation}
mcSimulation_results <-  decisionSupport::mcSimulation(
  estimate = estimate_read_csv("Input_tables/FarmerLC_inputdata.csv",sep =";"),
  model_function = farmer,
  numberOfModelRuns = 1e4, #10000
  functionSyntax = "plainNames")
  
```



#### References

